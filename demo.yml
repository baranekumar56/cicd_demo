# name: Deploy to cloud run
# on:
#   push:
#     branches:
#       -master
#       -main
#       -develop
#   pull_request:
#     branches:
#       -master
#       -main
#       -deevelop
#   workflow_dispatch:
#     inputs:
#       environment:
#         description: 'Development Environment'
#         required: true
#         default: 'dev'
#         type: choice
#         options: 
#           -dev
#           -stagging
#           -pod
# env:
#   GCP_REGION: us_central1
#   ARTIFACT_REGISTRY: demo
# jobs:
#   deploy:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4
#       - name: Authenticate to google cloud
#         uses: google-github-actions/auth@v2
#         with:
#           credentials_json: ${{ secrets.GCP_SA_KEY }}
#       - name: Set up gcloud CLI
#         uses: google-github-actions/setup-gcloud@v2
#         with:
#           project_id: ${{ secrets.GCP_PROJECT_ID }}
#       - name: Configure Docker for Google Artifact Registry
#         run: |
#           gcloud auth configure-docker "${ GCP_REGION }-docker.pkg.dev" --quiet
#       - name: Set Image tag
#         id: image-tag
#         run: |
#           echo "tag=${GCP_REGION}-docker.pkg.dev/${{ secrets.GCP_PROJECT_ID }}/${ARTIFACT_REGISTRY }/demo:latest" >> $GITHUB_OUTPUT
#           echo "tag-sha=${GCP_REGION}-docker.pkg.dev/${{ secrets.GCP_PROJECT_ID }}/${ARTIFACT_REGISTRY }/demo:${{ github.sha }}" >> $GITHUB_OUTPUT
#       - name: Build Docker Image
#         run: |
#           docker build -t ${{ steps.image-tag.outputs.tag }} -t ${{ steps.image-tag.outputs.tag-sha }} .
#       - name: Push Docker Image
#         run: |
#           docker push ${{ steps.image-tag.outputs.tag }}
#           docker push ${{ steps.image-tag.outputs.tag-sha }}
#       - name: Deploy to Cloud Run
#         run: |
#           gcloud run deploy demo \
#             --image ${{ steps.image-tag.outputs.tag }} \
#             --region $GCP_REGION \
#             --platform managed \
#             --allow-unauthenticated \
#             -- port 8080 \
#             -- cpu 1 \
#             --memory 512Mi \
#             --max-instances 5 \
#             --set-env-vars ENVIRONMENT=${{ github.event.inputs.environment }}
#             --timeout 300s
#             --quiet
#       - name: Get URL
#         run: |
#           URL=$(gcloud run services describe demo --region $GCP_REGION --platform managed --format 'value(status.url)')
#           echo "URL=$URL" >> $GITHUB_OUTPUT